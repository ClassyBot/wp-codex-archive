<p class="LanguageLinks" style="border:1px solid #CCCCCC; line-height:1.5; text-align:left; color:#333333; font-size:90%; padding:10px;"><span style="white-space:nowrap;"><a href="https://codex.wordpress.org/Multilingual_Codex" title="Multilingual Codex" class="mw-redirect">Languages</a>:</span> 
<a href="https://codex.wordpress.org/Widgets_API" title="Widgets API">English</a> • 
<a rel="nofollow" class="external text" href="https://wpdocs.osdn.jp/WordPress">ウィジェット API 日本語</a> 
<strong class="selflink">中文(简体)</strong> • 
 <small>(<a href="https://codex.wordpress.org/Multilingual_Codex#Language_Cross_Reference" title="Multilingual Codex" class="mw-redirect">Add your language</a>)</small>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.E5.B0.8F.E5.B7.A5.E5.85.B7.E6.8E.A5.E5.8F.A3"><span class="tocnumber">1</span> <span class="toctext">小工具接口</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#.E5.87.BD.E6.95.B0.E5.8F.82.E8.80.83"><span class="tocnumber">2</span> <span class="toctext">函数参考</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#.E5.BC.80.E5.8F.91.E6.96.B0.E7.9A.84.E6.8C.82.E4.BB.B6_.282.8_.E5.8F.8A.E4.BB.A5.E4.B8.8A.29"><span class="tocnumber">3</span> <span class="toctext">开发新的挂件 (2.8 及以上)</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#.E9.BB.98.E8.AE.A4.E7.94.A8.E6.B3.95"><span class="tocnumber">3.1</span> <span class="toctext">默认用法</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#.E7.A4.BA.E4.BE.8B"><span class="tocnumber">3.2</span> <span class="toctext">示例</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#.E5.BC.80.E5.8F.91.E6.96.B0.E7.9A.84.E5.B0.8F.E5.B7.A5.E5.85.B7"><span class="tocnumber">4</span> <span class="toctext">开发新的小工具</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#What_else_can_I_do_with_Widgets.3F"><span class="tocnumber">5</span> <span class="toctext">What else can I do with Widgets?</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Widgets_-_One_or_many"><span class="tocnumber">6</span> <span class="toctext">Widgets - One or many</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Resources"><span class="tocnumber">7</span> <span class="toctext">Resources</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id=".E5.B0.8F.E5.B7.A5.E5.85.B7.E6.8E.A5.E5.8F.A3">小工具接口</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=1" title="Edit section: 小工具接口">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>本页包含 WordPress 小工具接口（Widgets API）的技术文档。
如果您是一位主题设计者、或者插件作者，希望创建一个有效的挂件，建议您阅读本文。本文假定您了解 PHP 脚本语言的基础语法。
</p><p>所谓的小工具（widget）就是一个在被调用时会输出字符到标准输出的 <a rel="nofollow" class="external text" href="http://www.php.net/manual/en/language.functions.php">PHP 函数</a>。把 PHP 函数变成小工具，则需要注册。调用 WordPress 小工具接口所注册的 <a rel="nofollow" class="external text" href="http://www.php.net/manual/en/language.pseudo-types.php">PHP 回调函数</a>（PHP 文档中称之为<i>伪类型</i>）即可注册您的函数。如下：
</p><p>register_sidebar_widget($callback);
</p><p>WordPress 小工具接口部分的代码在 <code><a rel="nofollow" class="external text" href="https://core.trac.wordpress.org/browser/tags/5.2.3/src/wp-includes/widgets.php#L0">wp-includes/widgets.php</a></code> 中。
</p>
<h2><span class="mw-headline" id=".E5.87.BD.E6.95.B0.E5.8F.82.E8.80.83">函数参考</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=2" title="Edit section: 函数参考">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table cellspacing="10" width="100%">

<tr valign="top">
<td width="50%">
<table class="widefat">

<tr style="background:#464646; color:#d7d7d7;">
<th> <b>边栏函数</b>
</th></tr>
<tr>
<td>
<ul><li> <tt><a href="https://codex.wordpress.org/Function_Reference/is_active_sidebar" title="Function Reference/is active sidebar">is_active_sidebar</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/register_sidebars" title="Function Reference/register sidebars">register_sidebars</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/register_sidebar" title="Function Reference/register sidebar">register_sidebar</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/unregister_sidebar" title="Function Reference/unregister sidebar">unregister_sidebar</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/is_dynamic_sidebar" title="Function Reference/is dynamic sidebar">is_dynamic_sidebar</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/dynamic_sidebar" title="Function Reference/dynamic sidebar">dynamic_sidebar</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/register_sidebar_widget" title="Function Reference/register sidebar widget">register_sidebar_widget</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/unregister_sidebar_widget" title="Function Reference/unregister sidebar widget">unregister_sidebar_widget</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_register_sidebar_widget" title="Function Reference/wp register sidebar widget">wp_register_sidebar_widget</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_unregister_sidebar_widget" title="Function Reference/wp unregister sidebar widget">wp_unregister_sidebar_widget</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_get_sidebars_widgets" title="Function Reference/wp get sidebars widgets">wp_get_sidebars_widgets</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_set_sidebars_widgets" title="Function Reference/wp set sidebars widgets">wp_set_sidebars_widgets</a></tt></li></ul>
</td></tr></table>
</td>
<td width="50%">
<table class="widefat">

<tr style="background:#464646; color:#d7d7d7;">
<th> <b>挂件函数</b>
</th></tr>
<tr>
<td>
<ul><li> <tt><a href="https://codex.wordpress.org/Function_Reference/is_active_widget" title="Function Reference/is active widget">is_active_widget</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/the_widget" title="Function Reference/the widget">the_widget</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/register_widget" title="Function Reference/register widget">register_widget</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/unregister_widget" title="Function Reference/unregister widget">unregister_widget</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/register_widget_control" title="Function Reference/register widget control">register_widget_control</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/unregister_widget_control" title="Function Reference/unregister widget control">unregister_widget_control</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_register_widget_control" title="Function Reference/wp register widget control">wp_register_widget_control</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_unregister_widget_control" title="Function Reference/wp unregister widget control">wp_unregister_widget_control</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_convert_widget_settings" title="Function Reference/wp convert widget settings">wp_convert_widget_settings</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_get_widget_defaults" title="Function Reference/wp get widget defaults">wp_get_widget_defaults</a></tt></li>
<li> <tt><a href="https://codex.wordpress.org/Function_Reference/wp_widget_description" title="Function Reference/wp widget description">wp_widget_description</a></tt></li></ul>
</td></tr></table>
</td></tr></table>
<p><b>注意:</b> 建议您 <b>不要用</b> 这些以 "<i>wp_</i>" 开头的函数，因为可能在日后的版本中改变。这就是为什么我们使用 <a href="https://codex.wordpress.org/Function_Reference/register_sidebar_widget" title="Function Reference/register sidebar widget">register_sidebar_widget()</a> 替代<a href="https://codex.wordpress.org/Function_Reference/wp_register_sidebar_widget" title="Function Reference/wp register sidebar widget">wp_register_sidebar_widget()</a>的原因。
</p>
<h2><span class="mw-headline" id=".E5.BC.80.E5.8F.91.E6.96.B0.E7.9A.84.E6.8C.82.E4.BB.B6_.282.8_.E5.8F.8A.E4.BB.A5.E4.B8.8A.29">开发新的挂件 (2.8 及以上)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=3" title="Edit section: 开发新的挂件 (2.8 及以上)">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>从 2.8 开始，开发挂件的工作变得更加容易。你只需要继承标准的挂件类和它的几个函数就可以了。
</p><p>基类中包含了关于一个有效的挂件必须继承函数的信息。
</p>
<h3><span class="mw-headline" id=".E9.BB.98.E8.AE.A4.E7.94.A8.E6.B3.95">默认用法</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=4" title="Edit section: 默认用法">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<pre>
class My_Widget extends WP_Widget {
	function My_Widget() {
		// 挂件实例化
	}

	function widget($args, $instance) {
		// 输出挂件内容
	}

	function update($new_instance, $old_instance) {
		// 选项保存过程
	}

	function form($instance) {
		// 在管理界面输出选项表单
	}
}
register_widget('My_Widget');
</pre>
<h3><span class="mw-headline" id=".E7.A4.BA.E4.BE.8B">示例</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=5" title="Edit section: 示例">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>下面的代码创建了一个名为<i>FooWidget</i>的挂件。此挂件拥有一个设置标题的表单。
</p><p><br />
</p>
<pre>
/**
 * FooWidget Class
 */
class FooWidget extends WP_Widget {
    /** 构造函数 */
    function FooWidget() {
        parent::WP_Widget(false, $name = 'FooWidget');	
    }

    /** @see WP_Widget::widget */
    function widget($args, $instance) {		
        extract( $args );
       &#160;?&gt;
              &lt;?php echo $before_widget;&#160;?&gt;
                  &lt;?php echo $before_title
                      . $instance['title']
                      . $after_title;&#160;?&gt;
                  Hello, World!
              &lt;?php echo $after_widget;&#160;?&gt;
        &lt;?php
    }

    /** @see WP_Widget::update */
    function update($new_instance, $old_instance) {				
        return $new_instance;
    }

    /** @see WP_Widget::form */
    function form($instance) {				
        $title = esc_attr($instance['title']);
       &#160;?&gt;
            &lt;p&gt;&lt;label for="&lt;?php echo $this-&gt;get_field_id('title');&#160;?&gt;"&gt;&lt;?php _e('Title:');&#160;?&gt; &lt;input class="widefat" id="&lt;?php echo $this-&gt;get_field_id('title');&#160;?&gt;" name="&lt;?php echo $this-&gt;get_field_name('title');&#160;?&gt;" type="text" value="&lt;?php echo $title;&#160;?&gt;" /&gt;&lt;/label&gt;&lt;/p&gt;
        &lt;?php 
    }

} // class FooWidget
</pre>
<p>接着，这个简单的挂件可以注册在钩子 <i>widgets_init</i> 上:
</p>
<pre>
// 注册 FooWidget 挂件
add_action('widgets_init', create_function('', 'return register_widget("FooWidget");'));
</pre>
<p>就是这么简单。就自动获得了一个可重复选择的挂件。不再需要特别的调整了。
</p><p>在 <a href="https://codex.wordpress.org/zh-cn:%E7%89%88%E6%9C%AC_2.8#.E6.96.B0.E7.9A.84.E6.8C.82.E4.BB.B6.E6.8E.A5.E5.8F.A3" title="zh-cn:版本 2.8">版本信息</a> 中有更多的信息。
</p>
<h2><span class="mw-headline" id=".E5.BC.80.E5.8F.91.E6.96.B0.E7.9A.84.E5.B0.8F.E5.B7.A5.E5.85.B7">开发新的小工具</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=6" title="Edit section: 开发新的小工具">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The Google Search widget which was included in the deprecated (i.e. not needed since WordPress 2.2) <a rel="nofollow" class="external text" href="http://downloads.wordpress.org/plugin/widgets.zip">original widget plugin</a> is commented within inches of its life, so consider that your tutorial. Additionally, there are a few guidelines to follow:
</p>
<ul><li> Don’t execute any code while the plugin is being loaded. Use the plugins_loaded hook or you risk fatal errors due to undefined functions, or missing the boat completely because your plugin loaded before the one it depends on.</li>
<li> Use register_sidebar_widget($name, $callback) to add your widget to the admin interface.</li>
<li> Follow this template:</li></ul>
<pre>
      function widget_myuniquewidget($args) {
          extract($args);
     &#160;?&gt;
              &lt;?php echo $before_widget;&#160;?&gt;
                  &lt;?php echo $before_title
                      . 'My Unique Widget'
                      . $after_title;&#160;?&gt;
                  Hello, World!
              &lt;?php echo $after_widget;&#160;?&gt;
      &lt;?php
      }
      register_sidebar_widget('My Unique Widget',
          'widget_myuniquewidget');
</pre>
<p><b>Important</b>: To use the above in a plugin, wrap it with:
</p>
<pre>function widget_myuniquewidget_register() {
  --the above goes here--
  register_sidebar_widget('My Unique Widget','widget_myuniquewidget');}
add_action('init', widget_myuniquewidget_register);
</pre>
<ul><li> Don’t leave out $before_widget, $after_widget, $before_title, or $after_title by accident. They are required for compatibility with various themes.</li>
<li> Name your widget and its functions carefully. Those strings will be used as HTML attributes and you don’t want to cause identical id’s in a single HTML document.</li>
<li> Localization is done internally to preserve the HTML id attribute. If you want your widget name localized with a textdomain, pass array($name, $textdomain) instead of $name.</li>
<li> To accommodate multi-widgets (e.g. Text and RSS) you can also pass a replacement value with the name: array($name_as_sprintf_pattern, $textdomain, $replacement). See the source.</li>
<li> You may use the variables mentioned above in different ways, or neglect them in some circumstances. Some widgets may not need a title, for example. Some widgets will use the $before_widget and $after_widget several times, or as arguments to tell another template tag how to format its output.</li>
<li> Optionally, use the following syntax to add a configuration page to the admin. Your callback will be used within the main form, so you must not include any &lt;form&gt; tags or a form submit button.</li></ul>
<pre>
      register_widget_control($name, $callback [, $width [, $height ]] );
</pre>
<ul><li> Namespace your form elements so they don’t conflict with other widgets.</li>
<li> Each widget must have a unique name. You can replace an already-registered widget by registering another one with the same name, supplying your own callback.</li>
<li> Any extra arguments to register_sidebar_widget() or register_widget_control() will be passed to your callback. See the Text and RSS widgets for examples.</li>
<li> Any widget or control can be “unregistered” by passing an empty string to the registration function.</li>
<li> There are probably some undocumented functions. You are encouraged to read the source code and see how we’ve created the standard widgets using these functions.</li>
<li> Please test your widgets with several themes other than Classic and Default (they both use the ul/li/h2 markup).</li>
<li> Please audit the security of your widgets before distributing them.</li>
<li> If you would like your widget to be considered for use on WordPress.com, send a link (no attachments please) to widgets@wordpress.com and we’ll have a look.</li></ul>
<h2><span class="mw-headline" id="What_else_can_I_do_with_Widgets.3F">What else can I do with Widgets?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=7" title="Edit section: What else can I do with Widgets?">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>You have no idea how glad we are that you asked that. Here are a few ideas:
</p>
<ul><li> Write a theme that includes a special widget to set it apart from the others.</li>
<li> How about this for a special widget: a WordPress loop to show asides.</li>
<li> Register a replacement widget that buffers the original widget and transforms it somehow.</li>
<li> Remember that a “sidebar” is really just a name for a list. It can be displayed vertically or horizontally.</li>
<li> Remember that a “widget” is really just a name for a configurable code snippet. It can be invisible or it can be absolutely positioned.</li>
<li> Use the id and class attributes of any or all widgets in scripts to animate your sidebar.</li>
<li> Heck, use script.aculo.us or dbx (included with WordPress) to make your widgets draggable or even collapsible. Ain’t scripting sweet?</li>
<li> Remember that the widget control API is just for convenience. You can always set up your own admin page instead.</li>
<li> Support your users and get feedback so you can improve your widget. Put a link to your email or your site at the bottom of your widget control.</li>
<li> Send a link to your widgets to widgets@wordpress.com for review. We might put them up for everyone to use on WordPress.com. You could be internet famous!</li></ul>
<h2><span class="mw-headline" id="Widgets_-_One_or_many">Widgets - One or many</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=8" title="Edit section: Widgets - One or many">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Widgets can be coded so that they can exist one time or they can exist multiple times. Wordpress is doing the work for you to instantiate your Widget multiple times if you follow some rules.
</p>
<h2><span class="mw-headline" id="Resources">Resources</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A5%E5%8F%A3&amp;action=edit&amp;section=9" title="Edit section: Resources">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li> <a rel="nofollow" class="external text" href="http://brainfart.com.ua/post/lesson-wordpress-multi-widgets/">Multiple Widget Lesson</a></li>
<li> <a rel="nofollow" class="external text" href="http://jessealtman.com/2009/06/08/tutorial-wordpress-28-widget-api/">Tutorial for creating a widget using WordPress 2.8</a></li></ul>


