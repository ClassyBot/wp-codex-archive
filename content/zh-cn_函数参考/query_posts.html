<p class="LanguageLinks" style="border:1px solid #CCCCCC; line-height:1.5; text-align:left; color:#333333; font-size:90%; padding:10px;"><span style="white-space:nowrap;"><a href="https://codex.wordpress.org/Multilingual_Codex" title="Multilingual Codex" class="mw-redirect">Languages</a>:</span> 
<a href="https://codex.wordpress.org/Function_Reference/query_posts" title="Function Reference/query posts">English</a> • 
<a href="https://codex.wordpress.org/it:Riferimento_funzioni/query_posts" title="it:Riferimento funzioni/query posts">Italiano</a> • 

<a rel="nofollow" class="external text" href="https://wpdocs.osdn.jp/テンプレートタグ/query_posts">日本語</a> 
<strong class="selflink">中文(简体)</strong> • 
<a href="https://codex.wordpress.org/pt-br:Refer%C3%AAncia_de_Fun%C3%A7%C3%A3o/query_posts" title="pt-br:Referência de Função/query posts">Português do Brasil</a> • 

 <small>(<a href="https://codex.wordpress.org/Multilingual_Codex#Language_Cross_Reference" title="Multilingual Codex" class="mw-redirect">Add your language</a>)</small>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.E6.8F.8F.E8.BF.B0"><span class="tocnumber">1</span> <span class="toctext">描述</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#.E9.87.8D.E8.A6.81.E6.8F.90.E7.A4.BA"><span class="tocnumber">2</span> <span class="toctext">重要提示</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#.E7.94.A8.E6.B3.95"><span class="tocnumber">3</span> <span class="toctext">用法</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Usage_Note"><span class="tocnumber">3.1</span> <span class="toctext">Usage Note</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Parameters"><span class="tocnumber">4</span> <span class="toctext">Parameters</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Category_Parameters"><span class="tocnumber">4.1</span> <span class="toctext">Category Parameters</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Tag_Parameters"><span class="tocnumber">4.2</span> <span class="toctext">Tag Parameters</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#.E4.BD.9C.E8.80.85.E5.8F.82.E6.95.B0"><span class="tocnumber">4.3</span> <span class="toctext">作者参数</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Post_.26_Page_Parameters"><span class="tocnumber">4.4</span> <span class="toctext">Post &amp; Page Parameters</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Sticky_Post_Parameters"><span class="tocnumber">4.5</span> <span class="toctext">Sticky Post Parameters</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Time_Parameters"><span class="tocnumber">4.6</span> <span class="toctext">Time Parameters</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Pagination_Parameters"><span class="tocnumber">4.7</span> <span class="toctext">Pagination Parameters</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Offset_Parameter"><span class="tocnumber">4.8</span> <span class="toctext">Offset Parameter</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Orderby_Parameters"><span class="tocnumber">4.9</span> <span class="toctext">Orderby Parameters</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Order_Parameters"><span class="tocnumber">4.10</span> <span class="toctext">Order Parameters</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Custom_Field_Parameters"><span class="tocnumber">4.11</span> <span class="toctext">Custom Field Parameters</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Combining_Parameters"><span class="tocnumber">4.12</span> <span class="toctext">Combining Parameters</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#Examples"><span class="tocnumber">5</span> <span class="toctext">Examples</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#Exclude_Categories_From_Your_Home_Page"><span class="tocnumber">5.1</span> <span class="toctext">Exclude Categories From Your Home Page</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#Retrieve_a_Particular_Post"><span class="tocnumber">5.2</span> <span class="toctext">Retrieve a Particular Post</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Retrieve_a_Particular_Page"><span class="tocnumber">5.3</span> <span class="toctext">Retrieve a Particular Page</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Passing_variables_to_query_posts"><span class="tocnumber">5.4</span> <span class="toctext">Passing variables to query_posts</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="#Example_1"><span class="tocnumber">5.4.1</span> <span class="toctext">Example 1</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#Example_2"><span class="tocnumber">5.4.2</span> <span class="toctext">Example 2</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#Example_3"><span class="tocnumber">5.4.3</span> <span class="toctext">Example 3</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#Example_4"><span class="tocnumber">5.4.4</span> <span class="toctext">Example 4</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-27"><a href="#Preserving_the_Original_Query_.28Pagination_etc..29"><span class="tocnumber">5.5</span> <span class="toctext">Preserving the Original Query (Pagination etc.)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-28"><a href="#Usage_Tips"><span class="tocnumber">6</span> <span class="toctext">Usage Tips</span></a></li>
<li class="toclevel-1 tocsection-29"><a href="#Resources"><span class="tocnumber">7</span> <span class="toctext">Resources</span></a></li>
<li class="toclevel-1 tocsection-30"><a href="#Related"><span class="tocnumber">8</span> <span class="toctext">Related</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id=".E6.8F.8F.E8.BF.B0">描述</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=1" title="Edit section: 描述">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><tt>Query_posts</tt> 可以用来控制在循环<a href="https://codex.wordpress.org/The_Loop" title="The Loop">The Loop</a>中显示哪些文章。它可以接受各种参数，就像你的URL中使用的参数(例如：参数p，<tt>p=4</tt>表示只显示ID为4的文章).
</p><p><br />
通常的用法：
</p>
<ul><li>  在你的首页只显示一篇文章(若只想显示一个独立的页面page，可以通过WordPress管理后台，设置 -&gt; 阅读，在那里修改).</li>
<li>  显示一个特定的时间段内的所有文章.</li>
<li>  在首页只显示最新的文章.</li>
<li>  改变文章的显示顺序.</li>
<li>  只显示某个特定分类下的文章.</li>
<li>  不显示某个或多个分类下的文章.</li></ul>
<h2><span class="mw-headline" id=".E9.87.8D.E8.A6.81.E6.8F.90.E7.A4.BA">重要提示</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=2" title="Edit section: 重要提示">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The query_posts function is intended to be used to modify the main page Loop <i>only</i>. It is not intended as a means to create secondary Loops on the page. If you want to create separate Loops outside of the main one, you should create separate <a href="https://codex.wordpress.org/Function_Reference/WP_Query" title="Function Reference/WP Query" class="mw-redirect">WP_Query</a> objects and use those instead. Use of query_posts on Loops other than the main one can result in your main Loop becoming incorrect and possibly displaying things that you were not expecting.
</p><p>The query_posts function overrides and replaces the main query for the page. To save your sanity, do not use it for any other purpose.
</p>
<h2><span class="mw-headline" id=".E7.94.A8.E6.B3.95">用法</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=3" title="Edit section: 用法">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<pre>
&lt;?php

//The Query
query_posts('posts_per_page=5');

//The Loop
if ( have_posts() )&#160;: while ( have_posts() )&#160;: the_post();
 ..
endwhile; else:
 ..
endif;

//Reset Query
wp_reset_query();

?&gt;
</pre>
<h3><span class="mw-headline" id="Usage_Note">Usage Note</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=4" title="Edit section: Usage Note">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Place a call to <tt>query_posts()</tt> in one of your <a href="https://codex.wordpress.org/Templates" title="Templates">Template</a> files before <a href="https://codex.wordpress.org/The_Loop" title="The Loop">The Loop</a> begins. The <tt>wp_query</tt> object will generate a new SQL query using your parameters. When you do this, WordPress ignores the other parameters it receives via the URL (such as page number or category). If you want to preserve that information, you can use the <tt>$query_string</tt> global variable in the call to <tt>query_posts()</tt>.
</p><p>For example, to set the display order of the posts without affecting the rest of the query string, you could place the following before <a href="https://codex.wordpress.org/The_Loop" title="The Loop">The Loop</a>:
</p>
<pre>
global $query_string;
query_posts($query_string . "&amp;order=ASC");
</pre>
<p>When using <tt>query_posts</tt> in this way, the quoted portion of the argument <i>must</i> begin with an ampersand (&amp;).
</p><p><br />
</p>
<h2><span class="mw-headline" id="Parameters">Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=5" title="Edit section: Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This is not an exhaustive list yet. It is meant to show some of the more common things possible with setting your own queries.
</p>
<h3><span class="mw-headline" id="Category_Parameters">Category Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=6" title="Edit section: Category Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Show posts only belonging to certain categories.
</p>
<ul><li>  <tt>cat</tt> - must use cat ids </li>
<li>  <tt>category_name</tt></li>
<li>  <tt>category__and</tt> - must use cat ids</li>
<li>  <tt>category__in</tt> - must use cat ids</li>
<li>  <tt>category__not_in</tt> - must use cat ids</li></ul>
<p><b>Show One Category by ID</b>
</p><p>Display posts from only one category ID (and any children of that category):
</p>
<pre>query_posts('cat=4');
</pre>
<p><b>Show One Category by Name</b>
</p><p>Display posts from only one category by name:
</p>
<pre>query_posts('category_name=Staff Home');
</pre>
<p><b>Show Several Categories by ID</b>
</p><p>Display posts from several specific category IDs:
</p>
<pre>query_posts('cat=2,6,17,38');
</pre>
<p><b>Exclude Posts Belonging to Only One Category</b>
</p><p>Show all posts <i>except</i> those from a category by prefixing its ID with a '-' (minus) sign.
</p>
<pre>query_posts('cat=-3');
</pre>
<p>This excludes any post that belongs to category 3. 
</p><p><b>Multiple Category Handling</b>
</p><p>Display posts that are in multiple categories.  This shows posts that are in both categories 2 and 6:
</p>
<pre>query_posts(array('category__and' =&gt; array(2,6)));
</pre>
<p>To display posts from either category 2 OR 6, you could use <tt>cat</tt> as mentioned above, or by using <tt>category__in</tt> (note this does not show posts from any children of these categories):
</p>
<pre>query_posts(array('category__in' =&gt; array(2,6)));
</pre>
<p>You can also exclude multiple categories this way:
</p>
<pre>query_posts(array('category__not_in' =&gt; array(2,6)));
</pre>
<h3><span class="mw-headline" id="Tag_Parameters">Tag Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=7" title="Edit section: Tag Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Show posts associated with certain tags.
</p>
<ul><li>  <tt>tag</tt></li>
<li>  <tt>tag_id</tt> - must use tag ids </li>
<li>  <tt>tag__and</tt> - must use tag ids </li>
<li>  <tt>tag__in</tt> - must use tag ids </li>
<li>  <tt>tag__not_in</tt> - must use tag ids </li>
<li>  <tt>tag_slug__and</tt></li>
<li>  <tt>tag_slug__in</tt></li></ul>
<p><b>Fetch posts for one tag</b>
</p>
<pre>query_posts('tag=cooking');
</pre>
<p><b>Fetch posts that have either of these tags</b>
</p>
<pre>query_posts('tag=bread,baking');
</pre>
<p><b>Fetch posts that have all three of these tags:</b>
</p>
<pre>query_posts('tag=bread+baking+recipe');
</pre>
<p><b>Multiple Tag Handling</b>
</p><p>Display posts that are tagged with both tag id 37 and tag id 47:
</p>
<pre>query_posts(array('tag__and' =&gt; array(37,47));
</pre>
<p>To display posts from either tag id 37 or 47, you could use <tt>tag</tt> as mentioned above, or explicitly specify by using <tt>tag__in</tt>:
</p>
<pre>query_posts(array('tag__in' =&gt; array(37,47));
</pre>
<p>Display posts that do not have any of the two tag ids 37 and 47:
</p>
<pre>query_posts(array('tag__not_in' =&gt; array(37,47));
</pre>
<p>The <tt>tag_slug__in</tt> and <tt>tag_slug__and</tt> behave much the same, except match against the tag's slug.
</p><p>Also see <a rel="nofollow" class="external text" href="http://boren.nu/archives/2007/10/01/taxonomy-intersections-and-unions/">Ryan's discussion of Tag intersections and unions</a>.
</p>
<h3><span class="mw-headline" id=".E4.BD.9C.E8.80.85.E5.8F.82.E6.95.B0">作者参数</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=8" title="Edit section: 作者参数">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>你也可以通过作者限定文章
</p>
<ul><li>  <tt>author=3</tt></li>
<li>  <tt>author=-3</tt> 通过“负号”排除作者id为3的文章</li>
<li>  <tt>author_name=Harriet</tt></li></ul>
<p><b>注释：</b> <tt>author_name</tt>为定义于<tt>user_nicename</tt>中的字段，<tt>author</tt>为作者的id。
</p><p><b>排除置顶文章后依照标题排序显示所有作者ID为1的已发布<a href="/index.php?title=%E9%A1%B5%E9%9D%A2&amp;action=edit&amp;redlink=1" class="new" title="页面 (page does not exist)">页面</a>：</b> 
</p>
<pre>query_posts('caller_get_posts=1&amp;author=1&amp;post_type=page&amp;post_status=publish&amp;orderby=title&amp;order=ASC');
</pre>
<h3><span class="mw-headline" id="Post_.26_Page_Parameters">Post &amp; Page Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=9" title="Edit section: Post &amp; Page Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Retrieve a single post or page.
</p>
<ul><li>  <tt>'p' =&gt; 27</tt> - use the post ID to show that post </li>
<li>  <tt>'name' =&gt; 'about-my-life'</tt> - query for a particular post that has this <a href="https://codex.wordpress.org/Introduction_to_Blogging#Post_Slugs" title="Introduction to Blogging">Post Slug</a></li>
<li>  <tt>'page_id' =&gt; 7</tt> - query for just Page ID 7</li>
<li>  <tt>'pagename' =&gt; 'about'</tt> - note that this is not the page's title, but the page's path</li>
<li>  <tt>'posts_per_page' =&gt; 1</tt> - use <tt>'posts_per_page' =&gt; 3</tt> to show 3 posts. Use <tt>'posts_per_page' =&gt; -1</tt> to show all posts</li>
<li>  <tt>'showposts' =&gt; 1</tt> - use <tt>'showposts' =&gt; 3</tt> to show 3 posts. Use <tt>'showposts' =&gt; -1</tt> to show all posts.  <b>Deprecated in favor of posts_per_page</b></li>
<li>  <tt>'post__in' =&gt; array(5,12,2,14,7)</tt> - inclusion, lets you specify the post IDs to retrieve</li>
<li>  <tt>'post__not_in' =&gt; array(6,2,8)</tt> - exclusion, lets you specify the post IDs NOT to retrieve</li>
<li>  <tt>'post_type' =&gt; 'page'</tt> - returns <a href="https://codex.wordpress.org/Pages" title="Pages">Pages</a>; defaults to value of <tt>post</tt>; can be <tt>any</tt>, <tt>attachment</tt>, <tt>page</tt>, <tt>post</tt>, or <tt>revision</tt>. <tt>any</tt> retrieves any type except revisions. Also can designate custom post types (e.g. movies).</li>
<li>  <tt>'post_status' =&gt; 'publish'</tt> - returns publish works.  Also could use <tt>pending</tt>, <tt>draft</tt>, <tt>future</tt>, <tt>private</tt>, <tt>trash</tt>.  For <tt>inherit</tt> see <a href="https://codex.wordpress.org/Function_Reference/get_children" title="Function Reference/get children">get_children</a>.  Status of <tt>trash</tt> added with <a href="https://codex.wordpress.org/Version_2.9" title="Version 2.9">Version 2.9</a>.</li>
<li>  <tt>'post_parent' =&gt; 93</tt> - return just the child Pages of Page 93.</li></ul>
<p><b>To return both posts and custom post type movie</b>
</p>
<pre>query_posts( array( 'post_type' =&gt; array('post', 'movie') ) );
</pre>
<h3><span class="mw-headline" id="Sticky_Post_Parameters">Sticky Post Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=10" title="Edit section: Sticky Post Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Sticky posts first became available with WordPress Version 2.7.  Posts that are set as Sticky will be displayed before other posts in a query, unless excluded with the <i>caller_get_posts=1</i> parameter.
</p>
<ul><li> <tt>array('post__in'=&gt;get_option('sticky_posts'))</tt> - returns array of all sticky posts</li>
<li> <tt>caller_get_posts=1</tt> - To exclude sticky posts being included at the beginning of posts returned, but the sticky post will still be returned in the natural order of that list of posts returned.</li></ul>
<p><b>To return just the first sticky post</b>:
</p>
<pre>$sticky=get_option('sticky_posts')&#160;; 
query_posts('p=' . $sticky[0]);
</pre>
<p>or
</p>
<pre>
$args = array(
	'posts_per_page' =&gt; 1,
	'post__in'  =&gt; get_option('sticky_posts'),
	'caller_get_posts' =&gt; 1
);
query_posts($args);
</pre>
<p>Note: the second method returns only the more recent sticky post; if there are not sticky posts, it returns the last post published.
</p><p><b>To return just the first sticky post or nothing</b>:
</p>
<pre>
$sticky = get_option('sticky_posts');
$args = array(
	'posts_per_page' =&gt; 1,
	'post__in'  =&gt; $sticky,
	'caller_get_posts' =&gt; 1
);
query_posts($args);
if($sticky[0]) {
   // insert here your stuff...
}
</pre>
<p><br />
<b>To exclude all sticky posts from the query</b>:
</p>
<pre>query_posts(array("post__not_in" =&gt;get_option("sticky_posts")));
</pre>
<p><b>Return ALL posts with the category, but don't show sticky posts at the top.  The 'sticky posts' will still show in their natural position (e.g. by date):</b>
</p>
<pre>query_posts('caller_get_posts=1&amp;posts_per_page=3&amp;cat=6'); 
</pre>
<p><b>Return posts with the category, but exclude sticky posts completely, and adhere to paging rules:</b>
</p>
<pre>
&lt;?php
$paged = (get_query_var('paged'))&#160;? get_query_var('paged')&#160;: 1;
$sticky=get_option('sticky_posts');
$args=array(
   'cat'=&gt;3,
   'caller_get_posts'=&gt;1,
   'post__not_in' =&gt; $sticky,
   'paged'=&gt;$paged,
   );
query_posts($args);
?&gt;
</pre>
<h3><span class="mw-headline" id="Time_Parameters">Time Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=11" title="Edit section: Time Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Retrieve posts belonging to a certain time period.
</p>
<ul><li>  <tt>hour=</tt> - hour (from 0 to 23)</li>
<li>  <tt>minute=</tt> - minute (from 0 to 60)</li>
<li>  <tt>second=</tt> - second (0 to 60)</li>
<li>  <tt>day=</tt> - day of the month (from 1 to 31)</li>
<li>  <tt>monthnum=</tt> - month number (from 1 to 12)</li>
<li>  <tt>year=</tt> - 4 digit year (e.g. 2009)</li>
<li>  <tt>w=</tt> - week of the year (from 0 to 53) and uses the <a rel="nofollow" class="external text" href="http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_week">MySQL WEEK command Mode=1</a>.</li></ul>
<p><b>Returns posts for just the current date:</b>
</p>
<pre>$today = getdate();
query_posts('year=' .$today["year"] .'&amp;monthnum=' .$today["mon"] .'&amp;day=' .$today["mday"] );
</pre>
<p><b>Returns posts for just the current week:</b>
</p>
<pre>$week = date('W');
$year = date('Y');
query_posts('year=' . $year .'&amp;w=' .$week );
</pre>
<p><b>Returns posts dated December 20:</b>
</p>
<pre>query_posts( 'monthnum=12&amp;day=20' );
</pre>
<p><b>Return posts for posts for March 1 to March 15, 2009:</b>
</p>
<pre>
&lt;?php
//based on Austin Matzko's code from wp-hackers email list
  function filter_where($where = '') {
    //posts for March 1 to March 15, 2009
    $where .= " AND post_date &gt;= '2009-03-01' AND post_date &lt; '2009-03-16'";
    return $where;
  }
add_filter('posts_where', 'filter_where');
query_posts($query_string);
?&gt;
</pre>
<p><b>Return posts from the last 30 days:</b>
</p>
<pre>
&lt;?php
//based on Austin Matzko's code from wp-hackers email list
  function filter_where($where = '') {
    //posts in the last 30 days
    $where .= " AND post_date &gt; '" . date('Y-m-d', strtotime('-30 days')) . "'";
    return $where;
  }
add_filter('posts_where', 'filter_where');
query_posts($query_string);
?&gt;
</pre>   
<p><b>Return posts 30 to 60 days old</b>
</p>
<pre>
&lt;?php
//based on Austin Matzko's code from wp-hackers email list
  function filter_where($where = '') {
    //posts  30 to 60 days old
    $where .= " AND post_date &gt;= '" . date('Y-m-d', strtotime('-60 days')) . "'" . " AND post_date &lt;= '" . date('Y-m-d', strtotime('-30 days')) . "'";
    return $where;
  }
add_filter('posts_where', 'filter_where');
query_posts($query_string);
?&gt;
</pre>
<h3><span class="mw-headline" id="Pagination_Parameters">Pagination Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=12" title="Edit section: Pagination Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li>  <tt>nopaging=true</tt> - will disable pagination, displaying all posts</li>
<li>  <tt>posts_per_page=10</tt> - number of posts to show per page</li>
<li>  <tt>paged=2</tt> - show the posts that would normally show up just on page 2 when using the "Older Entries" link. You should set this to <tt>get_query_var( 'paged' )</tt> if you want your query to work with pagination.</li>
<li>  <tt>order=ASC</tt> - show posts in chronological order, DESC to show in reverse order (the default)</li></ul>
<h3><span class="mw-headline" id="Offset_Parameter">Offset Parameter</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=13" title="Edit section: Offset Parameter">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>You can <i>displace</i> or pass over one or more initial posts which would normally be collected by your query through the use of the offset parameter. 
</p><p>The following will display the 5 posts which follow the most recent (1): 
</p>
<pre>query_posts('posts_per_page=5&amp;offset=1');
</pre>
<h3><span class="mw-headline" id="Orderby_Parameters">Orderby Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=14" title="Edit section: Orderby Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Sort retrieved posts by this field.
</p>
<ul><li>  <tt>orderby=author</tt></li>
<li>  <tt>orderby=date</tt></li>
<li>  <tt>orderby=title</tt></li>
<li>  <tt>orderby=modified</tt></li>
<li>  <tt>orderby=menu_order</tt> <b>Note:</b> Only works with <a href="https://codex.wordpress.org/Pages" title="Pages">Pages</a>.</li>
<li>  <tt>orderby=parent</tt></li>
<li>  <tt>orderby=ID</tt></li>
<li>  <tt>orderby=rand</tt></li>
<li>  <tt>orderby=meta_value</tt> <b>Note:</b> A <tt>meta_key=keyname</tt> must also be present in the query.</li>
<li>  <tt>orderby=none</tt> - no order (available with <a href="https://codex.wordpress.org/Version_2.8" title="Version 2.8">Version 2.8</a>)</li>
<li>  <tt>orderby=comment_count</tt> - (available with <a href="https://codex.wordpress.org/Version_2.9" title="Version 2.9">Version 2.9</a>)</li></ul>
<h3><span class="mw-headline" id="Order_Parameters">Order Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=15" title="Edit section: Order Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Designates the ascending or descending order of the ORDERBY parameter.
</p>
<ul><li>  <tt>order=ASC</tt> - ascending order, lowest to highest value</li>
<li>  <tt>order=DESC</tt> - descending order, highest to lowest value</li></ul>
<h3><span class="mw-headline" id="Custom_Field_Parameters">Custom Field Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=16" title="Edit section: Custom Field Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Retrieve posts (or <a href="https://codex.wordpress.org/Pages" title="Pages">Pages</a>) based on a custom field key or value.   
</p>
<ul><li>  <tt>meta_key=</tt></li>
<li>  <tt>meta_value=</tt></li>
<li>  <tt>meta_compare=</tt> - operator to test the <tt>meta_value=</tt>, default is '=', with other possible values of '!=', '&gt;', '&gt;=', '&lt;', or '&lt;='</li></ul>
<p>Returns posts with custom fields matching both a key of 'color' AND a value of 'blue': 
</p>
<pre>query_posts('meta_key=color&amp;meta_value=blue'); 
</pre>
<p>Returns posts with a custom field key of 'color', regardless of the custom field value:
</p>
<pre>query_posts('meta_key=color'); 
</pre>
<p>Returns posts where the custom field value is 'color', regardless of the custom field key:
</p>
<pre>query_posts('meta_value=color');
</pre>
<p>Returns any <a href="https://codex.wordpress.org/Pages" title="Pages">Page</a> where the custom field value is 'green', regardless of the custom field key:
</p>
<pre>query_posts('post_type=page&amp;meta_value=green');
</pre>
<p>Returns both posts and <a href="https://codex.wordpress.org/Pages" title="Pages">Pages</a> with a custom field key of 'color' where the custom field value IS NOT EQUAL TO 'blue':
</p>
<pre>query_posts('post_type=any&amp;meta_key=color&amp;meta_compare=!=&amp;meta_value=blue');
</pre>
<p>Returns posts with custom field key of 'miles' with a custom field value that is LESS THAN OR EQUAL TO 22.  Note the value 99 will be considered greater than 100 as the data is stored as strings, not numbers.  
</p>
<pre>query_posts('meta_key=miles&amp;meta_compare=&lt;=&amp;meta_value=22');
</pre>
<h3><span class="mw-headline" id="Combining_Parameters">Combining Parameters</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=17" title="Edit section: Combining Parameters">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>You may have noticed from some of the examples above that you combine parameters with an ampersand (&amp;), like so: 
</p>
<pre>query_posts('cat=3&amp;year=2004');
</pre>
<p>Posts for category 13, for the current month on the main page:
</p>
<pre>if (is_home()) {
query_posts($query_string . '&amp;cat=13&amp;monthnum=' . date('n',current_time('timestamp')));
}
</pre>
<p>At 2.3 this combination will return posts belong to both Category 1 AND 3, showing just two (2) posts, in descending order by the title:
</p>
<pre> query_posts(array('category__and'=&gt;array(1,3),'posts_per_page'=&gt;2,'orderby'=&gt;title,'order'=&gt;DESC));
</pre>
<p><br />
In 2.3 and 2.5 one would expect the following to return all posts that belong to category 1 and is tagged "apples"
</p>
<pre>query_posts('cat=1&amp;tag=apples');
</pre>
<p>A bug prevents this from happening. See <a rel="nofollow" class="external text" href="http://trac.wordpress.org/ticket/5433">Ticket #5433</a>. A workaround is to search for several tags using +
</p>
<pre>query_posts('cat=1&amp;tag=apples+apples');
</pre>
<p>This will yield the expected results of the previous query. Note that using 'cat=1&amp;tag=apples+oranges' yields expected results.
</p>
<h2><span class="mw-headline" id="Examples">Examples</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=18" title="Edit section: Examples">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Exclude_Categories_From_Your_Home_Page">Exclude Categories From Your Home Page</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=19" title="Edit section: Exclude Categories From Your Home Page">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Placing this code in your <tt>index.php</tt> file will cause your home page to display posts from all categories <i>except</i> category ID 3.
</p>
<pre>
&lt;?php
   if (is_home()) {
      query_posts("cat=-3");
   }
?&gt;
</pre>
<p>You can also add some more categories to the exclude-list (tested with WP 2.1.2):
</p>
<pre>
&lt;?php
   if (is_home()) {
      query_posts("cat=-1,-2,-3");
   }
?&gt;
</pre>
<h3><span class="mw-headline" id="Retrieve_a_Particular_Post">Retrieve a Particular Post</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=20" title="Edit section: Retrieve a Particular Post">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>To retrieve a particular post, you could use the following:
</p>
<pre>
&lt;?php
// retrieve one post with an ID of 5
query_posts('p=5');      
?&gt;
</pre>
<p>If you want to use the <i>Read More</i> functionality with this query, you will need to set the global <tt>$more</tt> variable to 0.
</p>
<pre>
&lt;?php
// retrieve one post with an ID of 5
query_posts('p=5');
      
global $more;
// set $more to 0 in order to only get the first part of the post
$more = 0; 

// the Loop
while (have_posts())&#160;: the_post(); 
  // the content of the post
  the_content('Read the full post &#187;'); 
endwhile;
?&gt;
</pre>
<h3><span class="mw-headline" id="Retrieve_a_Particular_Page">Retrieve a Particular Page</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=21" title="Edit section: Retrieve a Particular Page">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>To retrieve a particular page, you could use the following:
</p>
<pre>
&lt;?php
query_posts('page_id=7');      //retrieves page 7 only
?&gt;
</pre>
<p>or
</p>
<pre>
&lt;?php
query_posts('pagename=about'); //retrieves the about page only
?&gt;
</pre>
<p>For child pages, the slug of the parent and the child is required, separated by a slash. For example:
</p>
<pre>
&lt;?php
query_posts('pagename=parent/child'); // retrieve the child page of a parent
?&gt;
</pre>
<h3><span class="mw-headline" id="Passing_variables_to_query_posts">Passing variables to query_posts</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=22" title="Edit section: Passing variables to query posts">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>You can pass a variable to the query with two methods, depending on your needs. As with other examples, place these above your Loop:
</p>
<h4><span class="mw-headline" id="Example_1">Example 1</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=23" title="Edit section: Example 1">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>In this example, we concatenate the query before running it. First assign the variable, then concatenate and then run it. Here we're pulling in a category variable from elsewhere. 
</p>
<pre>
 &lt;?php
 $categoryvariable=$cat; // assign the variable as current category
 $query= 'cat=' . $categoryvariable. '&amp;orderby=date&amp;order=ASC'; // concatenate the query
 query_posts($query); // run the query
 ?&gt;
</pre>
<h4><span class="mw-headline" id="Example_2">Example 2</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=24" title="Edit section: Example 2">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>In this next example, the double quotes tell PHP to treat the enclosed as an expression. For this example, we are getting the current month and the current year, and telling <tt>query_posts</tt> to bring us the posts for the current month/year, and in this case, listing in ascending order so we get the oldest post at the top of the page. 
</p>
<pre>
&lt;?php
$current_month = date('m');
$current_year = date('Y');

query_posts("cat=22&amp;year=$current_year&amp;monthnum=$current_month&amp;order=ASC");
?&gt;
&lt;!-- put your loop here --&gt;
</pre>
<h4><span class="mw-headline" id="Example_3">Example 3</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=25" title="Edit section: Example 3">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>This example explains how to generate a complete list of posts, dealing with pagination. We can use the default <tt>$query_string</tt> telling <tt>query_posts</tt> to bring us a full posts listing.  We can also modify the <tt>posts_per_page</tt> query argument from -1 to the number of posts you want to show on each page; in this last case, you'll probably want to use <a href="https://codex.wordpress.org/Template_Tags/posts_nav_link" title="Template Tags/posts nav link" class="mw-redirect">posts_nav_link()</a> to navigate the generated archive.
</p>
<pre>
&lt;?php 
query_posts($query_string.'&amp;posts_per_page=-1');
while(have_posts()) { the_post();
&lt;!-- put your loop here --&gt;
}
?&gt;
</pre>
<h4><span class="mw-headline" id="Example_4">Example 4</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=26" title="Edit section: Example 4">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>If you don't need to use the <tt>$query_string</tt> variable, another method exists that is more clear and readable, in some more complex cases. This method puts the parameters into an array. The same query as in Example 2 above could be done like this:
</p>
<pre>
query_posts(array(
 'cat'      =&gt; 22, 
 'year'     =&gt; $current_year, 
 'monthnum' =&gt; $current_month, 
 'order'    =&gt; 'ASC',
));
</pre>
<p>As you can see, with this approach, every variable can be put on its own line, for easier reading.
</p>
<h3><span class="mw-headline" id="Preserving_the_Original_Query_.28Pagination_etc..29">Preserving the Original Query (Pagination etc.)</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=27" title="Edit section: Preserving the Original Query (Pagination etc.)">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>By default running query_posts will completely overwrite all existing query variables on the current page. Pagination, categories dates etc. will be lost and only the variables you pass into query_posts will be used. 
</p><p>If you want to preserve the original query you can merge the original query array into your parameter array:
</p>
<pre>
global $wp_query;
query_posts(
	array_merge(
		array('cat' =&gt; 1),
		$wp_query-&gt;query
	)
);</pre>
<p><br />
</p>
<h2><span class="mw-headline" id="Usage_Tips">Usage Tips</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=28" title="Edit section: Usage Tips">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The "Blog pages show at most" parameter in Settings &gt; Reading can influence your results.  To overcome this, add the 'posts_per_page' parameter.  For example:
</p>
<pre>
query_posts('category_name=The Category Name&amp;posts_per_page=-1');  //returns ALL from the category
</pre>
<h2><span class="mw-headline" id="Resources">Resources</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=29" title="Edit section: Resources">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li> <a rel="nofollow" class="external text" href="http://www.ifelse.co.uk/archives/2005/04/08/query_posts-redux/">If..Else - Query Post Redux</a></li>
<li> <a rel="nofollow" class="external text" href="http://www.ifelse.co.uk/archives/2005/04/10/make-wp-show-only-one-post-on-the-front-page/">If..Else - Make WordPress Show Only one Post on the Front Page</a></li>
<li> <a rel="nofollow" class="external text" href="http://www.ifelse.co.uk/archives/2005/03/31/query_posts/">If..Else - Query Posts</a></li>
<li> <a rel="nofollow" class="external text" href="http://perishablepress.com/press/2008/01/22/6-ways-to-customize-wordpress-post-order/">Perishable Press - 6 Ways to Customize WordPress Post Order </a></li>
<li> <a rel="nofollow" class="external text" href="http://www.nietoperzka.com/wptraining/custom-order-of-posts-on-main-page/">nietoperzka's Custom order of posts on the main page</a></li>
<li> <a rel="nofollow" class="external text" href="http://www.darrenhoyt.com/2008/06/11/displaying-related-category-and-author-content-in-wordpress/">Displaying related category and author content</a></li>
<li><a rel="nofollow" class="external text" href="http://maymay.net/blog/2008/06/06/arbitrarily-exclude-posts-from-displaying-in-wordpress/">Exclude posts from displaying</a></li></ul>
<h2><span class="mw-headline" id="Related">Related</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:%E5%87%BD%E6%95%B0%E5%8F%82%E8%80%83/query_posts&amp;action=edit&amp;section=30" title="Edit section: Related">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div style="background-color:#F7F7F7; border:1px solid #CCCCCC; color:#000000; padding:7px; margin:0.5em auto 0.5em auto; vertical-align:middle; overflow:hidden;">See also index of <a href="https://codex.wordpress.org/Function_Reference" title="Function Reference">Function Reference</a> and index of <a href="https://codex.wordpress.org/Template_Tags" title="Template Tags">Template Tags</a>.</div>


