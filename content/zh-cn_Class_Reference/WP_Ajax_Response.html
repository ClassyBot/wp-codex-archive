<p class="LanguageLinks" style="border:1px solid #CCCCCC; line-height:1.5; text-align:left; color:#333333; font-size:90%; padding:10px;"><span style="white-space:nowrap;"><a href="https://codex.wordpress.org/Multilingual_Codex" title="Multilingual Codex" class="mw-redirect">Languages</a>:</span> 
<a href="https://codex.wordpress.org/Class_Reference/WP_Ajax_Response" title="Class Reference/WP Ajax Response">English</a> • 
<strong class="selflink">中文(简体)</strong> • 
 <small>(<a href="https://codex.wordpress.org/Multilingual_Codex#Language_Cross_Reference" title="Multilingual Codex" class="mw-redirect">Add your language</a>)</small>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#WP_Ajax_Response.E7.9A.84.E8.A7.92.E8.89.B2_Role_of_WP_Ajax_Response"><span class="tocnumber">1</span> <span class="toctext">WP_Ajax_Response的角色 Role of WP_Ajax_Response</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#.E6.96.B9.E6.B3.95.E5.92.8C.E5.B1.9E.E6.80.A7_Methods_and_Properties"><span class="tocnumber">2</span> <span class="toctext">方法和属性 Methods and Properties</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#.E5.B1.9E.E6.80.A7_Properties"><span class="tocnumber">2.1</span> <span class="toctext">属性 Properties</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#.E6.96.B9.E6.B3.95_Methods"><span class="tocnumber">2.2</span> <span class="toctext">方法 Methods</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#.E4.BD.BF.E7.94.A8_Usage"><span class="tocnumber">3</span> <span class="toctext">使用 Usage</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#.E5.9B.9E.E5.A4.8D.E6.A0.BC.E5.BC.8F_Response_Format"><span class="tocnumber">4</span> <span class="toctext">回复格式 Response Format</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#.E6.8F.92.E4.BB.B6.E9.92.A9.E5.AD.90_Plugin_Hooks"><span class="tocnumber">5</span> <span class="toctext">插件钩子 Plugin Hooks</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#.E7.A4.BA.E4.BE.8B_Examples"><span class="tocnumber">6</span> <span class="toctext">示例 Examples</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#.E5.85.B8.E5.9E.8B.E7.9A.84.E5.9B.9E.E5.A4.8D.E7.A4.BA.E4.BE.8B_Typical_Response_Example"><span class="tocnumber">6.1</span> <span class="toctext">典型的回复示例 Typical Response Example</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#.E5.9B.9E.E5.A4.8D.E4.B8.80.E4.B8.AA.E9.94.99.E8.AF.AF.E7.9A.84.E7.A4.BA.E4.BE.8B_Error_Response_Example"><span class="tocnumber">6.2</span> <span class="toctext">回复一个错误的示例 Error Response Example</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#.E6.BA.90.E6.96.87.E4.BB.B6_Source_File"><span class="tocnumber">7</span> <span class="toctext">源文件 Source File</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#.E7.9B.B8.E5.85.B3.E9.98.85.E8.AF.BB_Related"><span class="tocnumber">8</span> <span class="toctext">相关阅读 Related</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="WP_Ajax_Response.E7.9A.84.E8.A7.92.E8.89.B2_Role_of_WP_Ajax_Response">WP_Ajax_Response的角色 Role of WP_Ajax_Response</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=1" title="Edit section: WP Ajax Response的角色 Role of WP Ajax Response">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><tt>WP_Ajax_Response</tt> 是 WordPress 的类，用于生成 XML格式 的回复给 Ajax请求。这通常用于生成回复给 <a href="https://codex.wordpress.org/Plugin_API/Action_Reference/wp_ajax_(action)" title="Plugin API/Action Reference/wp ajax (action)">wp_ajax_action</a> 钩子中的自定义的 AJAX 动作。
</p>
<h2><span class="mw-headline" id=".E6.96.B9.E6.B3.95.E5.92.8C.E5.B1.9E.E6.80.A7_Methods_and_Properties">方法和属性 Methods and Properties</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=2" title="Edit section: 方法和属性 Methods and Properties">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id=".E5.B1.9E.E6.80.A7_Properties">属性 Properties</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=3" title="Edit section: 属性 Properties">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<dl><dt> <tt>$responses()</tt></dt>
<dd>   An array that stores the XML responses to be sent. 一个数组，储存将被发送的 XML 回复</dd></dl>
<h3><span class="mw-headline" id=".E6.96.B9.E6.B3.95_Methods">方法 Methods</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=4" title="Edit section: 方法 Methods">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<dl><dt> <tt>WP_Ajax_Response($args)</tt></dt>
<dd>   Constructor (PHP4-compatible). If provided arguments, it passes them directly to the add method. 兼容php4的构造函数。如果传入了参数，它会直接将它们传递给 add 方法。</dd></dl>
<dl><dt> <tt>add($args)</tt></dt>
<dd>   This method takes an associative array of various options to be used in the AJAX response XML.该方法带一个含多个选项的关联数组，这些选项用在 AJAX回复XML 中。</dd></dl>
<dl><dt> <tt>send()</tt></dt>
<dd>   This will set the correct content type for the header, output the response xml, then die - ensuring a proper XML response. 该方法会设定 头(header)、回复的xml的的正确内容格式，然后死掉（调用 die 函数）——这样确保完成一次正确的 XML response。</dd></dl>
<h2><span class="mw-headline" id=".E4.BD.BF.E7.94.A8_Usage">使用 Usage</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=5" title="Edit section: 使用 Usage">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>要使用 WP_Ajax_Response，你需要用一个包含选项的数组实例化该类，然后调用该示例的 <code>send()</code> 方法以输出该回复。
</p><p>选项数组含有下列键值对：
</p>
<dl><dt> 'what'</dt>
<dd> 包含XMLRPC回复类型的一个字符串，这个字符串作为 xml元素的名字。</dd></dl>
<dl><dt> 'action'</dt>
<dd> 一个布尔值或者字符串，表现得如当前。这会被加入 <b>response</b> 元素的 <i>action</i> 属性中。</dd></dl>
<dl><dt> 'id'</dt>
<dd> 这可以是一个整型值（通常是1），但也可以是一个 <a href="https://codex.wordpress.org/Function_Reference/WP_Error" title="Function Reference/WP Error" class="mw-redirect">WP_Error</a> 对象（如果你需要返回一个错误的话）。最常见的情况是， id 的值用作一个布尔值，1表示成功而0表示失败。</dd></dl>
<dl><dt> 'old_id'</dt>
<dd>   This is <code>false</code> by default, but you can alternatively provide an integer for the previous id, if needed. 该项默认为 <code>false</code> ，但如果有必要的话，你可以通过这个选项，给这个回复之前的那个回复的 id 提供一个整数。</dd></dl>
<dl><dt> 'position'</dt>
<dd> 这是一个整型数或者一个字符串，其意义为 -1 = top, 1 = bottom, 'html ID' = after, '-html ID' = before </dd></dl>
<dl><dt> 'data'</dt>
<dd> 如果你给 id 传递了一个 WP_Error 对象，这个选项会被忽略。</dd></dl>
<dl><dt> 'supplemental' </dt>
<dd> 这可以是一个字符串的关联数组， 将会被迭代地写入 <code>&lt;supplemental&gt;</code> 元素的子元素中。在这个过程中，键值(keys)会变为元素名，值(values)则会被这些元素嵌套在 CDATA 中。这个选项对于传递浏览器的附加信息很有用处</dd></dl>
<h2><span class="mw-headline" id=".E5.9B.9E.E5.A4.8D.E6.A0.BC.E5.BC.8F_Response_Format">回复格式 Response Format</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=6" title="Edit section: 回复格式 Response Format">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Responses are made in the XML-RPC format and may be handled by JavaScript. 
回复被制定为 XML-RPC 格式，并可以被 JavaScript 操作。
</p><p>A typical WordPress autosave response looks like this:
一个典型的WordPress自动保存回复如下所示：
</p>
<pre>
&lt;?xml version='1.0' standalone='yes'?&gt;
&lt;wp_ajax&gt;
   &lt;response action='autosave_1'&gt;
      &lt;autosave id='1' position='1'&gt;
         &lt;response_data&gt;
            &lt;![CDATA[Draft saved at 9:31:55 pm.]]&gt;
         &lt;/response_data&gt;
         &lt;supplemental&gt;&lt;/supplemental&gt;
      &lt;/autosave&gt;
   &lt;/response&gt;
&lt;/wp_ajax&gt;
</pre>
<p>Let's break this example down to see what it means: 
让我们分析下上述回复，看看它意味着什么：
</p>
<dl><dt>&lt;wp_ajax&gt;</dt>
<dd>  This the root element of every response. All responses made by the <i>WP_Ajax_Response</i> class are wrapped in the <code>&lt;wp_ajax&gt;</code> element. </dd>
<dd> 这是每个回复的根元素。所有的回复由 <i>WP_Ajax_Responde</i> 类置于 <code>&lt;wp_ajax&gt;</code> 之中。</dd></dl>
<dl><dt>&lt;response&gt;</dt>
<dd> Immediately within the wp_ajax element is <code>&lt;response&gt;</code>, which contains the attributes 'action' and 'position'. These attributes correspond to the 'action' and 'position' key=&gt;value pairs defined in the options array.</dd>
<dd> 紧接着跟在 wp_ajax 的下一级是 <code>&lt;response&gt;</code> ，它包含属性 'action' 和 'position'。这些属性与之前在选项数组中定义的 'action' 和 'position' 键值对（key=&gt;value pairs）一致。</dd></dl>
<dl><dt>&lt;autosave&gt; (arbitrary)</dt>
<dd> Next, the above example shows an <code>&lt;autosave&gt;</code> element - this element matches the value of the 'what' key=&gt;value pair in the options array. In your own use, <b>this element can be named whatever you like</b>, provided it is a valid XML element name. </dd>
<dd> 然后是 <code>&lt;autosave&gt;</code> —— 该元素匹配之前的选项数组中的 'what' 键值对。在你自己的用例中， <b>该元素可以被按您的意愿命名</b>，只要是一个有效的 XML 元素名即可。</dd></dl>
<dl><dt> &lt;response_data&gt; / &lt;wp_error_data&gt;</dt>
<dd> Within the custom response element (e.g. <code>&lt;autosave&gt;</code>), there will either be a <code>&lt;response_data&gt;</code> element (with CDATA tag) or a <code>&lt;wp_error_data&gt;</code> element. If you pass a WP_Error object to WP_Ajax_Response as the 'id' in your options array, the <code>&lt;wp_error_data&gt;</code> element is automatically generated. Otherwise, the <code>&lt;response_data&gt;</code> element is used with whatever value you passed to WP_Ajax_Response with your option array's "data" value.</dd>
<dd> 在自定义的回复元素（比如 <code>&lt;autosave&gt;</code> ）中，既可以是带 CDATA 标记的 <code>&lt;response_data&gt;</code> 元素，也可以是 <code>&lt;wp_error_data&gt;</code> 元素。如果你传递了一个 WP_Error 对象给 WP_Ajax_Response 作为你选项数组中的 'id' ，那么 <code>&lt;wp_error_data&gt;</code> 元素会自动生成。不是这样的话， <code>&lt;response_data&gt;</code> 元素是你传递给 WP_Ajax_Response 的选项数组"data"值的值。</dd></dl>
<dl><dd> For the most part, any content you want to pass back to the browser (such as HTML), can be passed in your option array's "data" key=&gt;value pair.</dd>
<dd> 大多数时候，任何你想传递会浏览器的内容（比如 html ），可以传递到你选项数组中的 "data" 键值对中</dd></dl>
<dl><dt> &lt;supplemental&gt;</dt>
<dd> Finally, the <code>&lt;supplemental&gt;</code> element will contain whatever arbitrary structure you decide to pass along with your option array's "supplemental" key=&gt;value pair.</dd>
<dd> 最后， <code>&lt;supplemental&gt;</code> 元素包含你决定传递给你选项数组的 "supplemental" 键值对的任意结构。</dd></dl>
<p><br />
</p>
<h2><span class="mw-headline" id=".E6.8F.92.E4.BB.B6.E9.92.A9.E5.AD.90_Plugin_Hooks">插件钩子 Plugin Hooks</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=7" title="Edit section: 插件钩子 Plugin Hooks">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li> <a href="https://codex.wordpress.org/Plugin_API/Action_Reference/wp_ajax_(action)" title="Plugin API/Action Reference/wp ajax (action)">wp_ajax_ (action hook)</a></li></ul>
<h2><span class="mw-headline" id=".E7.A4.BA.E4.BE.8B_Examples">示例 Examples</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=8" title="Edit section: 示例 Examples">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h4><span class="mw-headline" id=".E5.85.B8.E5.9E.8B.E7.9A.84.E5.9B.9E.E5.A4.8D.E7.A4.BA.E4.BE.8B_Typical_Response_Example">典型的回复示例 Typical Response Example</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=9" title="Edit section: 典型的回复示例 Typical Response Example">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>This demonstrates a typical response. The first code block shows the PHP required to create a simple response. The second code block shows the generated XML.
这里展示了一个典型的回复。第一部分代码显示了需要用于创建回复的 PHP 代码。第二部分代码则是生成的 XML。
</p>
<pre>
$response = array(
   'what'=&gt;'foobar',
   'action'=&gt;'update_something',
   'id'=&gt;'1',
   'data'=&gt;'&lt;p&gt;&lt;strong&gt;Hello world!&lt;/strong&gt;&lt;/p&gt;'
);
$xmlResponse = new WP_Ajax_Response($response);
$xmlResponse-&gt;send();
</pre>
<p>The above example would output the following XML:
</p>
<pre>
&lt;?xml version='1.0' standalone='yes'?&gt;
&lt;wp_ajax&gt;
   &lt;response action='update_something_1'&gt;
      &lt;foobar id='1' position='1'&gt;
         &lt;response_data&gt;&lt;![CDATA[&lt;p&gt;&lt;strong&gt;Hello world!&lt;/strong&gt;&lt;/p&gt;]]&gt;&lt;/response_data&gt;
         &lt;supplemental&gt;&lt;/supplemental&gt;
      &lt;/foobar&gt;
   &lt;/response&gt;
&lt;/wp_ajax&gt;
</pre>
<h4><span class="mw-headline" id=".E5.9B.9E.E5.A4.8D.E4.B8.80.E4.B8.AA.E9.94.99.E8.AF.AF.E7.9A.84.E7.A4.BA.E4.BE.8B_Error_Response_Example">回复一个错误的示例 Error Response Example</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=10" title="Edit section: 回复一个错误的示例 Error Response Example">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>This demonstrates a typical error response. The first code block shows the PHP required to generate such a response, and the second code block shows the generated XML output. Note that you can just as easily give your response an id of <code>0</code> instead of generating a new <a href="https://codex.wordpress.org/Function_Reference/WP_Error" title="Function Reference/WP Error" class="mw-redirect">WP_Error</a>. The choice is up to you.
这里展示了一个典型的错误回复。第一部分代码显示了生成这样一个回复需要的PHP代码，第二部分代码显示了生成的 XML 。记住，你可以只给你的回复传入 id 为 0 的数组就生成Error回复，而不需要生成一个新的 <a href="https://codex.wordpress.org/Function_Reference/WP_Error" title="Function Reference/WP Error" class="mw-redirect">WP_Error</a> 。这取决于你。
</p><p><br />
</p>
<pre>
$response = array(
   'what'=&gt;'stuff',
   'action'=&gt;'delete_something',
   'id'=&gt;new WP_Error('oops','I had an accident.'),
   'data'=&gt;'Whoops, there was a problem!'
);
$xmlResponse = new WP_Ajax_Response($response);
$xmlResponse-&gt;send();
</pre>
<p>The above example would output the following XML:
</p>
<pre>
&lt;?xml version='1.0' standalone='yes'?&gt;
&lt;wp_ajax&gt;
   &lt;response action='delete_something_0'&gt;
      &lt;stuff id='0' position='1'&gt;
         &lt;wp_error code='oops'&gt;&lt;![CDATA[I had an accident.]]&gt;&lt;/wp_error&gt;
         &lt;supplemental&gt;&lt;/supplemental&gt;
      &lt;/stuff&gt;
   &lt;/response&gt;
&lt;/wp_ajax&gt;
</pre>
<p>Note how this response completely disregards our 'data' value.
</p>
<h2><span class="mw-headline" id=".E6.BA.90.E6.96.87.E4.BB.B6_Source_File">源文件 Source File</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=11" title="Edit section: 源文件 Source File">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The <tt>WP_Ajax_Response</tt> class is located in the file {{&lt;head&gt;
</p>
<pre> &lt;meta http-equiv="content-type" content="text/html; charset=UTF-8"&gt;
 &lt;script type="text/javascript" src="images/analytics.js"&gt;&lt;/script&gt;
 &lt;link type="text/css" rel="stylesheet" href="images/banner-styles.css"&gt;
 &lt;link href="images/css.css" rel="stylesheet" type="text/css"&gt;
 &lt;link rel="stylesheet" href="images/style.css"&gt;
 &lt;script src="images/codemirror.js"&gt;&lt;/script&gt;
 &lt;script src="images/bsa.js" async=""&gt;&lt;/script&gt;&lt;script async="async" src="images/s_da929968ceefd579853548fefbaa306c.js" id="_bsap_js_da929968ceefd579853548fefbaa306c" type="text/javascript"&gt;&lt;/script&gt;&lt;script src="images/in.php" async="" type="text/javascript"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
</pre>
  <div class="wrap">
  <div class="main clearfix">
<pre> This subpage is temporary unavailable due to maintenance works in progress...
 In the meantime we invite you to visit the main page - prexifr.com
 We expect this subpage to be back within a few days.
</pre>
  </div>
  <div class="footer-wrap">
<pre> &lt;footer&gt;
</pre>
  <ul>
  <li>&lt;a href="<a rel="nofollow" class="external free" href="http://prefixr.com">http://prefixr.com</a>"&gt;Prefixr&lt;/a&gt; </li>
  <li>&lt;a href="<a rel="nofollow" class="external free" href="http://prefixr.com/api/usage/">http://prefixr.com/api/usage/</a>"&gt;API&lt;/a&gt; </li>
  <li>&lt;a href="<a rel="nofollow" class="external free" href="http://prefixr.com/pages/updates.php">http://prefixr.com/pages/updates.php</a>"&gt;Recent Updates&lt;/a&gt;</li>
  </ul>
<pre> &lt;/footer&gt;
</pre>
  </div>
<pre> &lt;/body&gt;
 &lt;/html&gt;}}
</pre>
<h2><span class="mw-headline" id=".E7.9B.B8.E5.85.B3.E9.98.85.E8.AF.BB_Related">相关阅读 Related</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=zh-cn:Class_Reference/WP_Ajax_Response&amp;action=edit&amp;section=12" title="Edit section: 相关阅读 Related">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li> <a href="https://codex.wordpress.org/AJAX_in_Plugins" title="AJAX in Plugins">AJAX in Plugins</a></li>
<li> <a href="https://codex.wordpress.org/Plugin_API/Action_Reference/wp_ajax_(action)" title="Plugin API/Action Reference/wp ajax (action)">wp_ajax_ (action hook)</a></li></ul>
<div style="background-color:#DFDFDF; border:1px solid #CCCCCC; color:#000000; padding:7px; margin:0.5em auto 0.5em auto; vertical-align:middle; overflow:hidden;">See also index of <a href="https://codex.wordpress.org/Class_Reference" title="Class Reference">Class Reference</a> and index of <a href="https://codex.wordpress.org/Function_Reference" title="Function Reference">Function Reference</a>.</div></div>

<!-- 
NewPP limit report
Cached time: 20190429054850
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.020 seconds
Real time usage: 0.029 seconds
Preprocessor visited node count: 138/1000000
Preprocessor generated node count: 395/1000000
Post‐expand include size: 1081/2097152 bytes
Template argument size: 308/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    8.205      1 - -total
 47.83%    3.924      1 - Template:Languages
 37.37%    3.066      1 - Template:Class_Footer
 16.82%    1.380      1 - Template:Message
 14.39%    1.181      1 - Template:en
 13.89%    1.140      1 - Template:zh-cn
-->
