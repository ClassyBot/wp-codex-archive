<p class="LanguageLinks" style="border:1px solid #CCCCCC; line-height:1.5; text-align:left; color:#333333; font-size:90%; padding:10px;"><span style="white-space:nowrap;"><a href="https://codex.wordpress.org/Multilingual_Codex" title="Multilingual Codex" class="mw-redirect">Languages</a>:</span> 
<strong class="selflink">English</strong> • 
<a rel="nofollow" class="external text" href="https://wpdocs.osdn.jp/Migrating">Plugins and Themes to 2.7 日本語</a> 
 <small>(<a href="https://codex.wordpress.org/Multilingual_Codex#Language_Cross_Reference" title="Multilingual Codex" class="mw-redirect">Add your language</a>)</small>
</p>
<div style="background-color:#FFFFFF; border:1px solid #FFFFFF; color:#000000; padding:7px; margin:0.5em auto 0.5em auto; vertical-align:middle; overflow:hidden;"><span style="float:left; margin:4px"><div class="floatleft"><a href="https://codex.wordpress.org/File:wp-alert.png" class="image"><img alt="wp-alert.png" src="/images/9/9c/wp-alert.png" width="58" height="69" /></a></div></span><b>This article, written to accord with WordPress 2.7, is now obsolete. Please take caution when following its contents, as many things may have changed.</b></div>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Fixing_Up_Your_Theme_or_Plugin"><span class="tocnumber">2</span> <span class="toctext">Fixing Up Your Theme or Plugin</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Themes"><span class="tocnumber">2.1</span> <span class="toctext">Themes</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Enhanced_Comment_Display_-_Threading.2C_Paging.2C_etc."><span class="tocnumber">2.1.1</span> <span class="toctext">Enhanced Comment Display - Threading, Paging, etc.</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Post_Classes"><span class="tocnumber">2.1.2</span> <span class="toctext">Post Classes</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Logout_from_Site"><span class="tocnumber">2.1.3</span> <span class="toctext">Logout from Site</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Excluding_Sticky_Posts_from_Custom_Queries"><span class="tocnumber">2.1.4</span> <span class="toctext">Excluding Sticky Posts from Custom Queries</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#Display_the_Sticky_Post_Class"><span class="tocnumber">2.1.5</span> <span class="toctext">Display the Sticky Post Class</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Using_specialized_header.2C_footer.2C_sidebar_templates"><span class="tocnumber">2.1.6</span> <span class="toctext">Using specialized header, footer, sidebar templates</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#The_Search_Form_Template_Tag"><span class="tocnumber">2.1.7</span> <span class="toctext">The Search Form Template Tag</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#Plugins"><span class="tocnumber">2.2</span> <span class="toctext">Plugins</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#Uninstall_Plugin_API"><span class="tocnumber">2.2.1</span> <span class="toctext">Uninstall Plugin API</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Administrative_Hooks_Added_and_Removed"><span class="tocnumber">2.2.2</span> <span class="toctext">Administrative Hooks Added and Removed</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Add_to_Settings_pages"><span class="tocnumber">2.2.3</span> <span class="toctext">Add to Settings pages</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Admin_Header"><span class="tocnumber">2.2.4</span> <span class="toctext">Admin Header</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Plugins_List_Page"><span class="tocnumber">2.2.5</span> <span class="toctext">Plugins List Page</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#Plugins_Need_to_Register_Their_Options"><span class="tocnumber">2.2.6</span> <span class="toctext">Plugins Need to Register Their Options</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Introduction">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=1" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>When a new major version of WordPress is released, such as WordPress 2.1 or 2.2, you may find that your Themes and Plugins no longer work the way you are used to. It could be that they are completely broken, because something in WordPress that was fundamental to them changed, but it's also possible that you can get them working again by updating some settings, or maybe just a small edit. 
</p><p>This article is part of a series on <a href="https://codex.wordpress.org/Migrating_Plugins_and_Themes" title="Migrating Plugins and Themes">Migrating Plugins and Themes</a>. It covers changes between WordPress <a href="https://codex.wordpress.org/Version_2.6" title="Version 2.6">Version 2.6</a> and <a href="https://codex.wordpress.org/Version_2.7" title="Version 2.7">Version 2.7</a>, and what you need to do to Plugins and Themes to get them working in Version 2.7. 
</p><p>If you are the author of your Theme or Plugin, or if you have modified or customized your Theme, then this article will help you upgrade your Theme/Plugin for 2.6. If your Theme or Plugin is distributed publicly, after getting it working you may want to add it to the Compatibility lists above, so your users will know it is working and which version they should be running.
</p>
<h2><span class="mw-headline" id="Fixing_Up_Your_Theme_or_Plugin">Fixing Up Your Theme or Plugin</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=2" title="Edit section: Fixing Up Your Theme or Plugin">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The following sections describe changes to WordPress that might affect your theme or plugin.
</p>
<h3><span class="mw-headline" id="Themes">Themes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=3" title="Edit section: Themes">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Enhanced_Comment_Display_-_Threading.2C_Paging.2C_etc.">Enhanced Comment Display - Threading, Paging, etc.</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=4" title="Edit section: Enhanced Comment Display - Threading, Paging, etc.">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Comments have many new features in WordPress 2.7, such as threading, nesting, paging, etc. They are built in, assuming that your theme supports them. For details on how to update your theme to take advantage of these new features, please see the <a href="https://codex.wordpress.org/Migrating_Plugins_and_Themes_to_2.7/Enhanced_Comment_Display" title="Migrating Plugins and Themes to 2.7/Enhanced Comment Display">Enhanced Comment Display</a> article.
</p>
<h4><span class="mw-headline" id="Post_Classes">Post Classes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=5" title="Edit section: Post Classes">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>WordPress 2.7 includes a new function for post classes, which will help theme authors perform simpler styling. The function is, appropriately enough, called <a href="https://codex.wordpress.org/Template_Tags/post_class" title="Template Tags/post class" class="mw-redirect">post_class()</a>.
</p><p>To use this function in a theme, you will simply add it to the Loop in a place that makes sense. Most themes encapsulate every post within a DIV of some sort. That DIV usually has a class="post" or something similar. Instead of that class, just add a call to post_class instead. Like so:
</p>
<pre>
&lt;div id="post-&lt;?php the_ID();&#160;?&gt;" &lt;?php post_class();&#160;?&gt;&gt;
</pre>
<p>The post_class() outputs the class="whatever" piece for that div. This includes several different classes of value: post, hentry (for hAtom microformat pages), category-X (where X is the slug of every category the post is in), and tag-X (similar, but with tags). It also adds "sticky" for posts marked as <a href="https://codex.wordpress.org/Sticky_Posts" title="Sticky Posts">Sticky Posts</a>. These make it easy to style different parts of the theme in different ways.
</p><p>For special cases where you want to add your own classes, post_class supports that too:
</p>
<pre>
&lt;?php post_class('special');&#160;?&gt;
</pre>
<p>This will add "special" to the class list. You can either give it a space separated list of classes, or an array of strings with one class each, if your code is more complex and that is more useful.
</p><p>For displaying posts outside the Loop or in an alternate Loop, the second parameter to the post_class function can be the post ID. Classes will then be determined from that post.
</p>
<pre>
&lt;?php post_class('',$post_id);&#160;?&gt;
</pre>
<h4><span class="mw-headline" id="Logout_from_Site">Logout from Site</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=6" title="Edit section: Logout from Site">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The <a href="https://codex.wordpress.org/Template_Tags" title="Template Tags">Template Tag</a> <a href="https://codex.wordpress.org/Function_Reference/wp_logout_url" title="Function Reference/wp logout url">wp_logout_url</a> was added in <a href="https://codex.wordpress.org/Version_2.7" title="Version 2.7">Version 2.7</a> to provide a nonced URL for logout purposes.  If a theme uses a construct such as  <tt>/wp-login.php?action=logout</tt> to offer the user a logout link that code should be updated to use the <a href="https://codex.wordpress.org/Function_Reference/wp_logout_url" title="Function Reference/wp logout url">wp_logout_url</a>.  A good example of the usage of <a href="https://codex.wordpress.org/Function_Reference/wp_logout_url" title="Function Reference/wp logout url">wp_logout_url</a> can be seen in the WordPress Default and Classic themes <tt>comments.php</tt> and <tt>comments-popup.php</tt> <a href="https://codex.wordpress.org/Templates" title="Templates">Templates</a>.
</p><p>Users will experience a <b>You are attempting to log out of example.com. Please try again.</b> message if the theme does not use <a href="https://codex.wordpress.org/Function_Reference/wp_logout_url" title="Function Reference/wp logout url">wp_logout_url</a> for the logout URL.
</p>
<h4><span class="mw-headline" id="Excluding_Sticky_Posts_from_Custom_Queries">Excluding Sticky Posts from Custom Queries</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=7" title="Edit section: Excluding Sticky Posts from Custom Queries">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The ability to designate a post as a sticky was added in <a href="https://codex.wordpress.org/Version_2.7" title="Version 2.7">Version 2.7</a>.  If you use a query posts loop, those sticky posts will be returned in your custom queries.  But, to prevent the sticky posts from being included, just add <b><tt>caller_get_posts=1</tt></b> to your query string.
</p>
<h4><span class="mw-headline" id="Display_the_Sticky_Post_Class">Display the Sticky Post Class</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=8" title="Edit section: Display the Sticky Post Class">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>Find:
</p><p>&lt;div class="post" id="post-&lt;?php the_ID(); ?&gt;"&gt;
</p><p>an add "&lt;?php sticky_class(); ?&gt;" as so:
</p><p>&lt;div class="post&lt;?php sticky_class(); ?&gt;" id="post-&lt;?php the_ID(); ?&gt;"&gt;
</p><p>Note that this is not necessary if you use the post_class() function, as explained above. Use of post_class() is preferred, but if you happen to need to do it manually, this will let you get the sticky status of a post.
</p>
<h4><span class="mw-headline" id="Using_specialized_header.2C_footer.2C_sidebar_templates">Using specialized header, footer, sidebar templates</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=9" title="Edit section: Using specialized header, footer, sidebar templates">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The revised hierarchy allows specification of the header, footer, and sidebar templates for a theme.  If a name is specified, a specialized header (or footer) will be included.  As was true in the past, if the theme contains no <tt>header.php</tt> (or <tt>footer.php</tt>) file then the header (or footer) from the default theme will be included.
</p>
<ul><li> get_header('myheader') will include <tt>header-myheader.php</tt></li>
<li> get_footer('myfooter') will include <tt>footer-myfooter.php</tt></li>
<li> get_sidebar('mysidebar') will include <tt>sidebar-mysidebar.php</tt></li></ul>
<h4><span class="mw-headline" id="The_Search_Form_Template_Tag">The Search Form Template Tag</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=10" title="Edit section: The Search Form Template Tag">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>In WordPress 2.7, there is a new search form template tag <b>get_search_form()</b>. In order to preserve compatibility with older themes, the template tag will first look to the theme folder to determine if <b>searchform.php</b> exists. If it does, the tag will use that file. If not, it will generate the HTML.
</p><p>The tag can also be filtered with the <b>get_search_form</b> filter, allowing plugin authors or theme designers to alter the structure of the search form entirely.
</p>
<h3><span class="mw-headline" id="Plugins">Plugins</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=11" title="Edit section: Plugins">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="Uninstall_Plugin_API">Uninstall Plugin API</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=12" title="Edit section: Uninstall Plugin API">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>There is a new plugin uninstall in WordPress 2.7 that allows a plugin to uninstall itself, when the user deletes the plugin. There are two uninstall methods that the plugin can implement. 
</p><p>The easiest way is by creating a file in the your main plugin directory named uninstall.php and then storing the uninstall code there. This file will be included when the user selects to "delete" the plugin from the WordPress plugins screen. Ideally, you would simply add code to remove any options or database information your plugin creates. This file does execute under the WordPress umbrella, so you have full access to WordPress functions from here.
</p><p>The second method of creating an uninstaller is by creating an action hook that will execute the uninstall routines and then using register_uninstall_hook() function to register the hook with WordPress. This method is somewhat more complex and intended for advanced plugin authors only.
</p>
<h4><span class="mw-headline" id="Administrative_Hooks_Added_and_Removed">Administrative Hooks Added and Removed</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=13" title="Edit section: Administrative Hooks Added and Removed">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The administration menus in WordPress were redesigned again for 2.7, and correspondingly, some plugin hooks (actions and filters) were added and removed. Here is a list (which may be incomplete):
</p><p><b>For a thorough listing of changes to filter and action hooks in WP 2.7 see these lists from the Hook Database at adambrown.info</b>
</p>
<ul><li> <a rel="nofollow" class="external text" href="http://adambrown.info/p/wp_hooks/version/2.7?new=1">New hooks in WP 2.7</a></li>
<li> <a rel="nofollow" class="external text" href="http://adambrown.info/p/wp_hooks/version/2.7?old=1">Hooks deprecated in WP 2.7</a></li></ul>
<h4><span class="mw-headline" id="Add_to_Settings_pages">Add to Settings pages</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=14" title="Edit section: Add to Settings pages">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>WordPress 2.7 adds a <a href="https://codex.wordpress.org/Settings_API" title="Settings API">Settings API</a> for inserting settings and setting sections into the existing WordPress settings panels. This means directly in those pages and not as a new page. The functions <a href="https://codex.wordpress.org/Function_Reference/add_settings_section" title="Function Reference/add settings section">add_settings_section()</a>, <a href="https://codex.wordpress.org/Function_Reference/add_settings_field" title="Function Reference/add settings field">add_settings_field()</a>, <a href="https://codex.wordpress.org/Function_Reference/register_setting" title="Function Reference/register setting">register_setting()</a>, <a href="https://codex.wordpress.org/Function_Reference/unregister_setting" title="Function Reference/unregister setting">unregister_setting()</a> implement this feature. The functions are found in <a rel="nofollow" class="external text" href="http://trac.wordpress.org/browser/trunk/wp-admin/includes/plugin.php">wp-admin/includes/plugin.php</a> and <a rel="nofollow" class="external text" href="http://trac.wordpress.org/browser/trunk/wp-admin/includes/template.php">wp-admin/includes/template.php</a> (also see the section below on registering options, which is just part of this API).
</p>
<h4><span class="mw-headline" id="Admin_Header">Admin Header</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=15" title="Edit section: Admin Header">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>The "sidemenu" action has been removed, since the section of the admin page header that used to add items to is no longer there. 
</p><p>There is a new "favorites" menu, using the 'favorite_actions' filter (see wp-admin/includes/template.php, function favorite_actions() near the bottom, to figure out how to use it).
</p>
<h4><span class="mw-headline" id="Plugins_List_Page">Plugins List Page</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=16" title="Edit section: Plugins List Page">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>There are two filters that let plugins add items to their display on the Plugins page:
</p>
<ul><li> plugin_action_links_{$plugin} filter -- lets you add a new action to the Actions column for your plugin. Example:</li></ul>
<pre>
$plugin = plugin_basename(__FILE__); 
add_filter("plugin_action_links_$plugin", 'my_plugin_actlinks' ); 
function my_plugin_actlinks( $links ) { 
 // Add a link to this plugin's settings page
 $settings_link = '&lt;a href="whatevertheurlis"&gt;Settings&lt;/a&gt;'; 
 array_unshift( $links, $settings_link ); 
 return $links; 
}
</pre>
<ul><li> after_plugin_row_{$plugin_file} filter - this allows you to add something to the end of the row of information displayed for your plugin - like the existing after_plugin_row filter, but specific to your plugin, so it only runs once instead of after each row of the plugin display</li></ul>
<h4><span class="mw-headline" id="Plugins_Need_to_Register_Their_Options">Plugins Need to Register Their Options</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Migrating_Plugins_and_Themes_to_2.7&amp;action=edit&amp;section=17" title="Edit section: Plugins Need to Register Their Options">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<p>If your plugin uses the "easy" method of saving options (described in more detail at <a href="https://codex.wordpress.org/Creating_Options_Pages" title="Creating Options Pages">Creating Options Pages</a>), then in a near-future version of WordPress (and in the current version of WordPress MU), plugins will need to register their options for them to be recognized as valid. 
</p><p>In WordPress, the functions register_setting() and unregister_setting() can be used to do this; these are simple wrappers for the functions that exist now in WordPressMU, add_option_update_handler() and remove_option_update_handler() (the new aliases will be added soon to WPMU as well). 
</p><p>While using these functions will not be required for 2.7, it will be required in a future version for any plugin that uses options.php as its post handler for option updates. So it is a good idea to modify your plugin to take advantage of this now, for forward compatibility.
</p><p>These functions have several purposes:
</p>
<ul><li> Whitelist options</li>
<li> Register sanitization callbacks</li>
<li> In WPMU, prevent admins (who are not necessarily trusted on a WPMU setup that allows anyone to create a blog) from tinkering with private options such as rewrite_rules or active_plugins.</li></ul>
<p>Here's how to use them (read the function documentation for <a rel="nofollow" class="external text" href="http://trac.wordpress.org/browser/trunk/wp-admin/includes/plugin.php">wp-admin/includes/plugin.php</a> for more information):
</p>
<ul><li> Define a group name for your options, such as 'some-options'</li>
<li> Do something like the following in an <a href="https://codex.wordpress.org/Plugin_API/Action_Reference#Administrative_Actions" title="Plugin API/Action Reference">admin_init</a> action for each setting you want to update:</li></ul>
<pre>
register_setting('some-options', 'option-1', 'intval');
</pre>
<p>Where <tt>some-options</tt> is the name given to your options group. This is the same name used in the settings_field function. This particular setting is named <tt>option-1</tt> and <a href="https://codex.wordpress.org/Data_Validation#Integers" title="Data Validation">intval</a> is a sanitize callback function.
</p>
<ul><li> Do this in your option update form:</li></ul>
<pre>
settings_fields('some-options');
</pre>
<p>settings_fields() outputs all of the hidden fields that options.php
will check, including the nonce.  You no longer need to setup the
page_options hidden field if you use the new API.
</p><p>If you have used the function check_admin_referer() to secure your forms, you have to change its argument. If you use settings_fields('some-options') to output the nonce, you have to use the following argument ...
</p>
<pre>
check_admin_referer('some-options-options');
</pre>
<p>... to let WordPress check, if the nonce is correct.
</p><p>Notice the trailing '-options'!
</p>
<hr />

<!-- 
NewPP limit report
Cached time: 20190429054059
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.032 seconds
Real time usage: 0.170 seconds
Preprocessor visited node count: 180/1000000
Preprocessor generated node count: 509/1000000
Post‐expand include size: 1364/2097152 bytes
Template argument size: 447/2097152 bytes
Highest expansion depth: 4/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   39.122      1 - -total
 50.06%   19.586      1 - Template:Languages
 49.69%   19.439      1 - Template:Oldpage
 16.38%    6.410      1 - Template:en
  3.43%    1.343      1 - Template:Message
  3.42%    1.336      1 - Template:ja
-->
