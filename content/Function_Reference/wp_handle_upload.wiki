{{Languages|
{{en|Function_Reference/wp_handle_upload}}
{{ja|関数リファレンス/wp_handle_upload}}
}}
==Description==
Handle PHP uploads in WordPress, sanitizing file names, checking extensions for mime type, and moving the file to the appropriate directory within the uploads directory.

==Usage==

%%%<?php wp_handle_upload( $file, $overrides, $time ); ?>%%%

==Parameters==

{{Parameter|$file|array|Reference to a single element of <tt>$_FILES</tt>. Call the function once for each uploaded file. Passed by reference, so '''you must pass a variable, not a literal.'''}}
{{Parameter|$overrides|array|An associative array to override default behaviors. When called while handling a form, <tt>'action'</tt> must be set to match the <tt>'action'</tt> parameter in the form or the upload will be rejected. When there is no form being handled, use <tt>'test_form' &#x003D;&gt; false</tt> to bypass this test, and set <tt>'action'</tt> to something other than the default (<tt>"wp_handle_upload"</tt>) to bypass security checks requiring the file in question to be a user-uploaded file.|optional|false}}
{{Parameter|$time|string|Time formatted in 'yyyy/mm'. Passed to <tt>wp_upload_dir()</tt>.|optional|NULL}}

==Examples==
<pre>
if ( ! function_exists( 'wp_handle_upload' ) ) {
    require_once( ABSPATH . 'wp-admin/includes/file.php' );
}

$uploadedfile = $_FILES['file'];

$upload_overrides = array( 'test_form' => false );

$movefile = wp_handle_upload( $uploadedfile, $upload_overrides );

if ( $movefile && ! isset( $movefile['error'] ) ) {
    echo "File is valid, and was successfully uploaded.\n";
    var_dump( $movefile );
} else {
    /**
     * Error generated by _wp_handle_upload()
     * @see _wp_handle_upload() in wp-admin/includes/file.php
     */
    echo $movefile['error'];
}
</pre>

== Return values ==

On success, returns an associative array of file attributes. On failure, returns <tt>$overrides['upload_error_handler'](&$file, $message )</tt> or <tt>array( 'error'=>$message )</tt>.

The return values on success:

; <tt>file</tt> : (''string'') The local path to the uploaded file.
; <tt>url</tt> : (''string'') The public URL for the uploaded file.
; <tt>type</tt> : (''string'') The MIME type.

<tt>type</tt> and <tt>file</tt> may be used with [http://codex.wordpress.org/Function_Reference/wp_insert_attachment wp insert attachment()].

== Further Reading ==

* [http://wordpress.stackexchange.com/questions/4307/how-can-i-add-an-image-upload-field-directly-to-a-custom-write-panel/4413#4413 How can I add an image upload field directly to a custom write panel?]
* [http://ottopress.com/2011/tutorial-using-the-wp_filesystem/ Tutorial: Using the WP_Filesystem]
* [https://github.com/zanematthew/zm-upload/ Sample Helper Class on GitHub]

== Source File ==
<tt>wp_handle_upload()</tt> is located in {{Trac|wp-admin/includes/file.php|tags/4.7.2|423}}.

== Related ==

{{Upload Tags}}

{{Tag Footer}}

[[Category:Functions|*]]